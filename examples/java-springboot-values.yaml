# Example values for Java Spring Boot application
replicaCount: 2

image:
  repository: cloudwalkersinc/my-springboot-app
  pullPolicy: IfNotPresent
  tag: "1.0.0"

service:
  type: ClusterIP
  ports:
    - name: http
      port: 8080
      targetPort: 8080
      protocol: TCP
    - name: actuator
      port: 8081
      targetPort: 8081
      protocol: TCP

env:
  - name: SPRING_PROFILES_ACTIVE
    value: "production"
  - name: JAVA_OPTS
    value: "-Xmx512m -Xms256m"
  - name: DATABASE_URL
    valueFrom:
      secretKeyRef:
        name: db-credentials
        key: url

envFrom:
  - configMapRef:
      name: app-config

livenessProbe:
  httpGet:
    path: /actuator/health/liveness
    port: actuator
  initialDelaySeconds: 60
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

readinessProbe:
  httpGet:
    path: /actuator/health/readiness
    port: actuator
  initialDelaySeconds: 30
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 3

startupProbe:
  httpGet:
    path: /actuator/health
    port: actuator
  initialDelaySeconds: 0
  periodSeconds: 10
  failureThreshold: 30  # 30 * 10s = 5min for slow Java startup

resources:
  limits:
    cpu: 1000m
    memory: 1Gi
  requests:
    cpu: 500m
    memory: 512Mi

autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 10
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80
  behavior:
    scaleDown:
      stabilizationWindowSeconds: 300  # Wait 5min before scaling down (JVM warmup is expensive)
      policies:
      - type: Percent
        value: 50  # Remove max 50% of pods
        periodSeconds: 60
      - type: Pods
        value: 1  # Or max 1 pod per minute
        periodSeconds: 60
      selectPolicy: Min  # Choose the smaller change
    scaleUp:
      stabilizationWindowSeconds: 60  # Wait 1min to assess load
      policies:
      - type: Percent
        value: 100  # Add up to 100% (double)
        periodSeconds: 60
      - type: Pods
        value: 2  # Or max 2 pods per minute
        periodSeconds: 60
      selectPolicy: Max  # Choose the larger change for faster response
